<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="RcloneGui.Features.Settings.Views.RcloneSettingsPage"
    NavigationCacheMode="Required"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:RcloneGui.Features.Settings.Views"
    xmlns:vm="using:RcloneGui.Features.Settings.ViewModels"
    xmlns:models="using:RcloneGui.Core.Models"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Resources>
        <local:ProfileDisplayNameConverter x:Key="ProfileDisplayNameConverter"/>
        <local:ProfileDescriptionConverter x:Key="ProfileDescriptionConverter"/>
    </Page.Resources>

    <ScrollViewer Padding="0,0,16,0">
        <StackPanel Padding="24" MaxWidth="900" HorizontalAlignment="Left">
            <!-- Header -->
            <TextBlock Text="Rclone Settings" Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock Text="Configure performance and VFS cache settings for all mounts" 
                       Style="{StaticResource CaptionTextBlockStyle}" 
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Margin="0,4,0,24"/>
            
            <!-- Performance Profile -->
            <TextBlock Text="Performance Profile" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,0,0,16"/>
            
            <StackPanel Spacing="12">
                <TextBlock Text="Quick Configuration" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                
                <ComboBox x:Name="ProfileComboBox"
                          SelectedItem="{x:Bind ViewModel.SelectedProfile, Mode=OneWay}"
                          HorizontalAlignment="Stretch"
                          MaxWidth="400"
                          SelectionChanged="ProfileComboBox_SelectionChanged">
                    <ComboBox.ItemTemplate>
                        <DataTemplate x:DataType="models:VfsPerformanceProfile">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" 
                                           Text="{x:Bind Converter={StaticResource ProfileDisplayNameConverter}}" 
                                           VerticalAlignment="Center"/>
                                <FontIcon Grid.Column="1" 
                                          Glyph="&#xE946;" 
                                          FontSize="12"
                                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                          Margin="8,0,0,0"
                                          ToolTipService.ToolTip="{x:Bind Converter={StaticResource ProfileDescriptionConverter}}"/>
                            </Grid>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
                
                <InfoBar x:Name="ProfileInfoBar"
                         IsOpen="False"
                         IsClosable="False"/>
            </StackPanel>
            
            <!-- VFS Cache Settings -->
            <TextBlock Text="VFS Cache Settings" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,24,0,16"/>
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                    <TextBlock Text="Cache Mode" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock Text="Controls how files are cached locally"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,2,0,8"/>
                    <ComboBox x:Name="CacheModeCombo"
                              SelectedItem="{x:Bind ViewModel.CacheMode, Mode=TwoWay}"
                              HorizontalAlignment="Stretch"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Margin="8,0,0,0">
                    <TextBlock Text="Max Cache Size" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock Text="Maximum disk space for cache (e.g., 10G, 500M)"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,2,0,8"/>
                    <TextBox x:Name="CacheMaxSizeBox"
                             Text="{x:Bind ViewModel.CacheMaxSize, Mode=TwoWay}"
                             PlaceholderText="10G"
                             HorizontalAlignment="Stretch"/>
                </StackPanel>
            </Grid>
            
            <Grid Margin="0,16,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                    <TextBlock Text="Max Cache Age" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock Text="How long to keep cached files (e.g., 72h, 7d)"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,2,0,8"/>
                    <TextBox x:Name="CacheMaxAgeBox"
                             Text="{x:Bind ViewModel.CacheMaxAge, Mode=TwoWay}"
                             PlaceholderText="72h (optional)"
                             HorizontalAlignment="Stretch"/>
                </StackPanel>
            </Grid>
            
            <!-- Directory Caching -->
            <TextBlock Text="Directory Caching" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,24,0,16"/>
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                    <TextBlock Text="Directory Cache Time" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock Text="How long to cache directory listings"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,2,0,8"/>
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <NumberBox x:Name="DirCacheTimeBox"
                                   Grid.Column="0"
                                   Value="{x:Bind ViewModel.DirCacheTimeMinutes, Mode=TwoWay}"
                                   Minimum="0"
                                   Maximum="1440"
                                   SpinButtonPlacementMode="Compact"/>
                        
                        <TextBlock Grid.Column="1" Text="minutes" VerticalAlignment="Center" Margin="8,0,0,0"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </Grid>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Margin="8,0,0,0">
                    <TextBlock Text="Poll Interval" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock Text="Check for remote changes (0 = disabled)"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,2,0,8"/>
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <NumberBox x:Name="PollIntervalBox"
                                   Grid.Column="0"
                                   Value="{x:Bind ViewModel.PollInterval, Mode=TwoWay}"
                                   Minimum="0"
                                   Maximum="86400"
                                   SpinButtonPlacementMode="Compact"/>
                        
                        <TextBlock Grid.Column="1" Text="seconds" VerticalAlignment="Center" Margin="8,0,0,0"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </Grid>
                </StackPanel>
            </Grid>
            
            <!-- Transfer Performance -->
            <TextBlock Text="Transfer Performance" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,24,0,16"/>
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                    <TextBlock Text="Buffer Size" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock Text="Memory buffer for transfers (e.g., 16M, 32M)"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,2,0,8"/>
                    <TextBox x:Name="BufferSizeBox"
                             Text="{x:Bind ViewModel.BufferSize, Mode=TwoWay}"
                             PlaceholderText="16M"
                             HorizontalAlignment="Stretch"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Margin="8,0,0,0">
                    <TextBlock Text="Chunk Size" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock Text="Transfer chunk size (e.g., 64M, 128M)"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,2,0,8"/>
                    <TextBox x:Name="ChunkSizeBox"
                             Text="{x:Bind ViewModel.ChunkSize, Mode=TwoWay}"
                             PlaceholderText="64M"
                             HorizontalAlignment="Stretch"/>
                </StackPanel>
            </Grid>
            
            <Grid Margin="0,16,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                    <TextBlock Text="Parallel Transfers" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock Text="Number of concurrent file transfers"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,2,0,8"/>
                    
                    <NumberBox x:Name="TransfersBox"
                               Value="{x:Bind ViewModel.Transfers, Mode=TwoWay}"
                               Minimum="1"
                               Maximum="64"
                               SpinButtonPlacementMode="Compact"
                               HorizontalAlignment="Stretch"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Margin="8,0,0,0">
                    <TextBlock Text="Parallel Checkers" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock Text="Concurrent directory scanning threads"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,2,0,8"/>
                    
                    <NumberBox x:Name="CheckersBox"
                               Value="{x:Bind ViewModel.Checkers, Mode=TwoWay}"
                               Minimum="1"
                               Maximum="128"
                               SpinButtonPlacementMode="Compact"
                               HorizontalAlignment="Stretch"/>
                </StackPanel>
            </Grid>
            
            <!-- Advanced Settings Toggle -->
            <Expander x:Name="AdvancedExpander"
                      Header="Advanced Settings"
                      Margin="0,24,0,0"
                      IsExpanded="False">
                
                <StackPanel Spacing="16" Margin="0,8,0,0">
                    
                    <StackPanel Orientation="Horizontal" Spacing="16">
                        <ToggleSwitch x:Name="AsyncReadSwitch"
                                      Header="Async Read"
                                      OffContent="Disabled"
                                      OnContent="Enabled"
                                      IsOn="{x:Bind ViewModel.AsyncRead, Mode=TwoWay}"
                                      ToolTipService.ToolTip="Enable asynchronous read operations for better performance"/>
                        
                        <ToggleSwitch x:Name="AsyncWriteSwitch"
                                      Header="Async Write"
                                      OffContent="Disabled (Safer)"
                                      OnContent="Enabled"
                                      IsOn="{x:Bind ViewModel.AsyncWrite, Mode=TwoWay}"
                                      ToolTipService.ToolTip="Enable asynchronous writes - faster but less safe on crashes"/>
                    </StackPanel>
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0" Margin="0,0,8,0">
                            <TextBlock Text="Umask" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            <TextBlock Text="File permission mask (octal)"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       Margin="0,2,0,8"/>
                            
                            <TextBox x:Name="UmaskBox"
                                     Text="{x:Bind ViewModel.Umask, Mode=TwoWay}"
                                     PlaceholderText="000"
                                     MaxLength="4"
                                     HorizontalAlignment="Stretch"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1" Margin="8,0">
                            <TextBlock Text="UID" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            <TextBlock Text="User ID"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       Margin="0,2,0,8"/>
                            
                            <NumberBox x:Name="UIDBox"
                                       Value="{x:Bind ViewModel.Uid, Mode=TwoWay}"
                                       Minimum="0"
                                       SpinButtonPlacementMode="Compact"
                                       HorizontalAlignment="Stretch"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="2" Margin="8,0,0,0">
                            <TextBlock Text="GID" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            <TextBlock Text="Group ID"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       Margin="0,2,0,8"/>
                            
                            <NumberBox x:Name="GIDBox"
                                       Value="{x:Bind ViewModel.Gid, Mode=TwoWay}"
                                       Minimum="0"
                                       SpinButtonPlacementMode="Compact"
                                       HorizontalAlignment="Stretch"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Expander>
            
            <!-- Mount Command Preview -->
            <TextBlock Text="Mount Command Preview" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,24,0,16"/>
            
            <StackPanel Spacing="8">
                <TextBlock Text="Preview of rclone mount command with current settings:"
                           Style="{StaticResource CaptionTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                
                <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                        CornerRadius="4"
                        Padding="12">
                    
                    <TextBlock x:Name="CommandPreviewText"
                               Text="{x:Bind ViewModel.MountCommandPreview, Mode=OneWay}"
                               Style="{StaticResource BodyTextBlockStyle}"
                               TextWrapping="Wrap"
                               FontFamily="Consolas"
                               Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                </Border>
            </StackPanel>
            
            <!-- Action Buttons -->
            <StackPanel Orientation="Horizontal" 
                        HorizontalAlignment="Left" 
                        Spacing="8"
                        Margin="0,32,0,24">
                <Button Content="Save Settings" 
                        Style="{StaticResource AccentButtonStyle}"
                        Click="Save_Click">
                    <Button.ContentTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE74E;" FontSize="16"/>
                                <TextBlock Text="Save Settings"/>
                            </StackPanel>
                        </DataTemplate>
                    </Button.ContentTemplate>
                </Button>
                
                <Button Content="Reset to Defaults" 
                        Click="ResetToDefaults_Click">
                    <Button.ContentTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE72C;" FontSize="16"/>
                                <TextBlock Text="Reset to Defaults"/>
                            </StackPanel>
                        </DataTemplate>
                    </Button.ContentTemplate>
                </Button>
            </StackPanel>
            
        </StackPanel>
    </ScrollViewer>
</Page>