<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="RcloneGui.Views.SettingsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:RcloneGui.Views"
    xmlns:converters="using:RcloneGui.Converters">
    
    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibility"/>
    </Page.Resources>
    
    <ScrollViewer>
        <StackPanel Padding="24" MaxWidth="800" HorizontalAlignment="Left">
            <!-- Header -->
            <TextBlock Text="Settings" Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock Text="Configure application preferences and manage rclone" 
                       Style="{StaticResource CaptionTextBlockStyle}" 
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Margin="0,4,0,24"/>
            
            <!-- Startup Settings -->
            <TextBlock Text="Startup" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,0,0,16"/>
            
            <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                  CornerRadius="8" Padding="16">
                <StackPanel>
                    <ToggleSwitch Header="Start with Windows"
                                  IsOn="{x:Bind ViewModel.StartWithWindows, Mode=TwoWay}"
                                  OffContent="Application won't start automatically"
                                  OnContent="Application starts with Windows"/>
                    
                    <ToggleSwitch Header="Start minimized"
                                  IsOn="{x:Bind ViewModel.StartMinimized, Mode=TwoWay}"
                                  OffContent="Shows main window on startup"
                                  OnContent="Starts minimized to tray"
                                  Margin="0,8,0,0"/>
                    
                    <ToggleSwitch Header="Auto-mount saved drives"
                                  IsOn="{x:Bind ViewModel.AutoMountOnStartup, Mode=TwoWay}"
                                  OffContent="Drives must be mounted manually"
                                  OnContent="Auto-mount enabled drives on startup"
                                  Margin="0,8,0,0"/>
                    
                    <ToggleSwitch Header="Unmount all on exit"
                                  IsOn="{x:Bind ViewModel.UnmountOnClose, Mode=TwoWay}"
                                  OffContent="Keep drives mounted when app closes"
                                  OnContent="Unmount all drives when app exits"
                                  Margin="0,8,0,0"/>
                </StackPanel>
            </Grid>
            
            <!-- System Tray Settings -->
            <TextBlock Text="System Tray" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,24,0,16"/>
            
            <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                  CornerRadius="8" Padding="16">
                <StackPanel>
                    <ToggleSwitch Header="Minimize to tray"
                                  IsOn="{x:Bind ViewModel.MinimizeToTray, Mode=TwoWay}"
                                  OffContent="Closes to taskbar"
                                  OnContent="Minimizes to system tray"/>
                    
                    <ToggleSwitch Header="Show notifications"
                                  IsOn="{x:Bind ViewModel.ShowNotifications, Mode=TwoWay}"
                                  OffContent="Notifications disabled"
                                  OnContent="Show mount/unmount notifications"
                                  Margin="0,8,0,0"/>
                </StackPanel>
            </Grid>
            
            <!-- Appearance -->
            <TextBlock Text="Appearance" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,24,0,16"/>
            
            <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                  CornerRadius="8" Padding="16">
                <StackPanel>
                    <TextBlock Text="Theme" Style="{StaticResource BodyStrongTextBlockStyle}" Margin="0,0,0,8"/>
                    <ComboBox x:Name="ThemeCombo" 
                              SelectedIndex="{x:Bind ViewModel.SelectedThemeIndex, Mode=TwoWay}" 
                              HorizontalAlignment="Stretch" MaxWidth="300">
                        <ComboBoxItem Content="System default"/>
                        <ComboBoxItem Content="Light"/>
                        <ComboBoxItem Content="Dark"/>
                    </ComboBox>
                </StackPanel>
            </Grid>
            
            <!-- Rclone Settings -->
            <TextBlock Text="Rclone" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,24,0,16"/>
            
            <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                  CornerRadius="8" Padding="16">
                <StackPanel>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Rclone Version" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            <TextBlock Text="{x:Bind ViewModel.RcloneVersion, Mode=OneWay}"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Check for Updates" VerticalAlignment="Center"/>
                    </Grid>
                    
                    <Border Height="1" 
                            Background="{ThemeResource DividerStrokeColorDefaultBrush}"
                            Margin="0,16"/>
                    
                    <TextBlock Text="Custom rclone path (optional)" 
                               Style="{StaticResource BodyStrongTextBlockStyle}" 
                               Margin="0,0,0,8"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0" 
                                 PlaceholderText="Uses bundled rclone by default"
                                 Text="{x:Bind ViewModel.CustomRclonePath, Mode=TwoWay}"/>
                        <Button Grid.Column="1" Content="Browse" Margin="8,0,0,0" Click="BrowseRclone_Click"/>
                    </Grid>
                    
                    <Border Height="1" 
                            Background="{ThemeResource DividerStrokeColorDefaultBrush}"
                            Margin="0,16"/>
                    
                    <TextBlock Text="VFS Cache Directory" 
                               Style="{StaticResource BodyStrongTextBlockStyle}" 
                               Margin="0,0,0,8"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0" 
                                 PlaceholderText="Default: %TEMP%\rclone"
                                 Text="{x:Bind ViewModel.CacheDirectory, Mode=TwoWay}"/>
                        <Button Grid.Column="1" Content="Browse" Margin="8,0,0,0" Click="BrowseCacheDir_Click"/>
                    </Grid>
                </StackPanel>
            </Grid>
            
            <!-- WinFsp Status -->
            <TextBlock Text="WinFsp" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,24,0,16"/>
            
            <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                  CornerRadius="8" Padding="16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Status Icon -->
                    <Grid Grid.Column="0" 
                          Width="40" Height="40" 
                          CornerRadius="20"
                          Margin="0,0,16,0">
                        <Grid Background="Green" 
                              Visibility="{x:Bind ViewModel.IsWinFspInstalled, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
                            <FontIcon Glyph="&#xE73E;" FontSize="20" Foreground="White"/>
                        </Grid>
                        <Grid Background="Orange" 
                              Visibility="{x:Bind ViewModel.IsWinFspInstalled, Mode=OneWay, Converter={StaticResource InverseBoolToVisibility}}">
                            <FontIcon Glyph="&#xE7BA;" FontSize="20" Foreground="White"/>
                        </Grid>
                    </Grid>
                    
                    <!-- Status Text -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Style="{StaticResource BodyStrongTextBlockStyle}">
                            <Run Text="WinFsp: "/>
                            <Run Text="{x:Bind ViewModel.WinFspVersion, Mode=OneWay}"/>
                        </TextBlock>
                        <TextBlock Text="Required for mounting drives as Windows file system"
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   Visibility="{x:Bind ViewModel.IsWinFspInstalled, Mode=OneWay, Converter={StaticResource BoolToVisibility}}"/>
                        <TextBlock Text="WinFsp is required to mount drives. Click Install to set up."
                                   Style="{StaticResource CaptionTextBlockStyle}"
                                   Foreground="Orange"
                                   Visibility="{x:Bind ViewModel.IsWinFspInstalled, Mode=OneWay, Converter={StaticResource InverseBoolToVisibility}}"/>
                    </StackPanel>
                    
                    <!-- Install Button -->
                    <Button Grid.Column="2" 
                            Content="Install WinFsp"
                            Style="{StaticResource AccentButtonStyle}"
                            Visibility="{x:Bind ViewModel.IsWinFspInstalled, Mode=OneWay, Converter={StaticResource InverseBoolToVisibility}}"
                            Command="{x:Bind ViewModel.InstallWinFspCommand}"/>
                </Grid>
            </Grid>
            
            <!-- Data Management -->
            <TextBlock Text="Data" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,24,0,16"/>
            
            <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                  CornerRadius="8" Padding="16">
                <StackPanel>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Export Configuration" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            <TextBlock Text="Export all connections and settings to a file"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Export" VerticalAlignment="Center"
                                Click="ExportConfig_Click"/>
                    </Grid>
                    
                    <Border Height="1" 
                            Background="{ThemeResource DividerStrokeColorDefaultBrush}"
                            Margin="0,16"/>
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Import Configuration" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            <TextBlock Text="Import connections and settings from a backup file"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Import" VerticalAlignment="Center"
                                Click="ImportConfig_Click"/>
                    </Grid>
                    
                    <Border Height="1" 
                            Background="{ThemeResource DividerStrokeColorDefaultBrush}"
                            Margin="0,16"/>
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Clear VFS Cache" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                            <TextBlock Text="Remove all cached files to free up disk space"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Clear Cache" VerticalAlignment="Center"
                                Command="{x:Bind ViewModel.ClearCacheCommand}"/>
                    </Grid>
                </StackPanel>
            </Grid>
            
            <!-- About -->
            <TextBlock Text="About" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,24,0,16"/>
            
            <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                  CornerRadius="8" Padding="16">
                <StackPanel>
                    <TextBlock Text="Rclone GUI" Style="{StaticResource SubtitleTextBlockStyle}"/>
                    <TextBlock Text="Version 0.0.1"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Margin="0,4,0,0"/>
                    <TextBlock Text="A modern Windows GUI for mounting SFTP servers as local drives using rclone."
                               Style="{StaticResource BodyTextBlockStyle}"
                               TextWrapping="Wrap"
                               Margin="0,12,0,0"/>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,16,0,0" Spacing="8">
                        <HyperlinkButton Content="GitHub Repository" NavigateUri="https://github.com/thorved/rclone-gui"/>
                        <HyperlinkButton Content="Rclone Documentation" NavigateUri="https://rclone.org/docs/"/>
                        <HyperlinkButton Content="Report Issue" NavigateUri="https://github.com/thorved/rclone-gui/issues"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
            
            <Grid Height="48"/>
        </StackPanel>
    </ScrollViewer>
</Page>
